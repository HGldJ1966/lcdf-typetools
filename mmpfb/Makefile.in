PACKAGE		= mminstance
VERSION		= @VERSION@

.SUFFIXES:
.SUFFIXES: .cc .c .o

.cc.o:
	$(CXX) $(CPPFLAGS) $(CXXFLAGS) -c $<

.c.o:
	$(CC) $(CPPFLAGS) $(CFLAGS) -c $<

SHELL		= /bin/sh
prefix		= @prefix@
exec_prefix	= @exec_prefix@
VPATH		= @srcdir@
srcdir		= @srcdir@
topdir		= @top_srcdir@
bindir		= @bindir@
mandir		= @mandir@/man$(manext)
manext		= 1

INSTALL		= @INSTALL@
INSTALL_PROGRAM	= @INSTALL_PROGRAM@
INSTALL_DATA	= @INSTALL_DATA@
mkinstalldirs	= $(SH) $(srcdir)/../mkinstalldirs
PROG_TRANSFORM	= @program_transform_name@

CC		= @CC@ $(PROFILING)
CCLINKER	= @CC@ $(PROFILING)
CXX		= @CXX@ $(PROFILING)
CXXLINKER	= @CXX@ $(PROFILING)
CXXFLAGS	= @CFLAGS@
CFLAGS		= @CFLAGS@
CPPFLAGS	= @DEFS@ -I$(topdir)/edlib -I$(topdir)/t1lib
PROFILING	= 
LDFLAGS		= @LDFLAGS@ @LIBS@

PROGRAMS	= mmpfb
MY_OBJS		= vectori.o hashmapi.o t1rewrit.o myfont.o main.o
OBJS		= ../edlib/permstr.o ../edlib/straccum.o \
	../edlib/landmark.o ../edlib/error.o ../edlib/clp.o ../t1lib/t1cs.o \
	../t1lib/t1interp.o ../t1lib/t1item.o ../t1lib/t1font.o \
	../t1lib/t1mm.o ../t1lib/t1rw.o $(MY_OBJS)

all: $(PROGRAMS)

mmpfb: $(OBJS)
	$(CXXLINKER) $(CFLAGS) -o mmpfb $(OBJS) $(LDFLAGS)

t1rewrit.o: t1rewrit.cc t1rewrit.hh ../t1lib/t1interp.hh

main.o: main.cc
	$(CXX) -DVERSION=\"$(VERSION)\" $(CPPFLAGS) $(CXXFLAGS) -c $<

install: install-prog install-man
install-prog: mmpfb
	$(mkinstalldirs) $(bindir)
	$(INSTALL_PROGRAM) mmpfb $(bindir)/`echo mmpfb|sed '$(PROG_TRANSFORM)'`
install-man:
	$(mkinstalldirs) $(mandir)
	$(INSTALL_DATA) $(srcdir)/mmpfb.man $(mandir)/`echo mmpfb|sed '$(PROG_TRANSFORM)'`.$(manext)

uninstall:
	rm -f $(bindir)/`echo mmpfb|sed '$(PROG_TRANSFORM)'`
	rm -f $(mandir)/`echo mmpfb|sed '$(PROG_TRANSFORM)'`.$(manext)

#####
# Cleaning and distribution

clean:
	rm -f $(PROGRAMS) $(MY_OBJS) core *.core
mostlyclean: clean
distclean: mostlyclean
	rm -f Makefile
realclean: distclean

dist:
	mkdir -m 0777 ../$(PACKAGE)-$(VERSION)/mmpfb
	cp Makefile.in hashmapi.cc vectori.cc myfont.cc myfont.hh main.cc \
	mmpfb.man \
	../$(PACKAGE)-$(VERSION)/mmpfb

.PHONY: all install install-prog install-man uninstall \
	clean mostlyclean distclean realclean dist
