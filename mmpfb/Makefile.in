PACKAGE		= mminstance
VERSION		= @VERSION@

.SUFFIXES:
.SUFFIXES: .cc .c .o

.cc.o:
	$(CXX) $(CPPFLAGS) $(CXXFLAGS) -c $<

.c.o:
	$(CC) $(CPPFLAGS) $(CFLAGS) -c $<

SHELL		= /bin/sh
prefix		= @prefix@
exec_prefix	= @exec_prefix@
VPATH		= @srcdir@/mmpfb
srcdir		= @srcdir@/mmpfb

CC		= @CC@ $(PROFILING)
CCLINKER	= @CC@ $(PROFILING)
CXX		= @CXX@ $(PROFILING)
CXXLINKER	= @CC@ $(PROFILING)
CXXFLAGS	= @CFLAGS@
CFLAGS		= @CFLAGS@
CPPFLAGS	= @DEFS@ -I../edlib -I../t1lib -I../metricslib
PROFILING	= 
LDFLAGS		= @LDFLAGS@

PROGRAMS	= mmpfb
MY_OBJS		= vectori.o hashmapi.o myfont.o main.o
OBJS		= ../edlib/permstr.o ../edlib/straccum.o \
	../edlib/landmark.o ../edlib/error.o ../edlib/clp.o ../t1lib/t1cs.o \
	../t1lib/t1interp.o ../t1lib/t1item.o ../t1lib/t1font.o \
	../t1lib/t1mm.o ../t1lib/t1rw.o ../t1lib/t1rewrit.o $(MY_OBJS)

all: $(PROGRAMS)

mmpfb: $(OBJS)
	$(CXXLINKER) $(CFLAGS) -o mmpfb $(OBJS) $(LDFLAGS)

t1mm.o: ../t1lib/t1mm.cc ../t1lib/t1mm.hh
	$(CXX) $(CPPFLAGS) $(CXXFLAGS) -c ../t1lib/t1mm.cc -o t1mm.o

main.o: main.cc
	$(CXX) -DVERSION=\"$(VERSION)\" $(CPPFLAGS) $(CXXFLAGS) -c main.cc

#####
# Cleaning and distribution

clean:
	rm -f $(PROGRAMS) $(MY_OBJS) core *.core
mostlyclean: clean
distclean: mostlyclean
	rm -f Makefile
realclean: distclean

dist:
	mkdir -m 0777 ../$(PACKAGE)-$(VERSION)/mmpfb
	cp Makefile.in hashmapi.cc vectori.cc myfont.cc myfont.hh main.cc \
	mmpfb.min \
	../$(PACKAGE)-$(VERSION)/mmpfb
