PACKAGE		= mminstance
VERSION		= @VERSION@

.SUFFIXES:
.SUFFIXES: .cc .c .o

.cc.o:
	$(CXX) $(CPPFLAGS) $(CXXFLAGS) -c $<

.c.o:
	$(CC) $(CPPFLAGS) $(CFLAGS) -c $<

SHELL		= /bin/sh
prefix		= @prefix@
exec_prefix	= @exec_prefix@
VPATH		= @srcdir@/mmafm
srcdir		= @srcdir@/mmafm
bindir		= @bindir@
mandir		= @mandir@/man$(manext)
manext		= 1

INSTALL		= @INSTALL@
INSTALL_PROGRAM	= @INSTALL_PROGRAM@
INSTALL_DATA	= @INSTALL_DATA@

CC		= @CC@ $(PROFILING)
CCLINKER	= @CC@ $(PROFILING)
CXX		= @CXX@ $(PROFILING)
CXXLINKER	= @CXX@ $(PROFILING)
CXXFLAGS	= @CFLAGS@
CFLAGS		= @CFLAGS@
CPPFLAGS	= @DEFS@ -I../edlib -I../t1lib -I../metricslib
PROFILING	= 
LDFLAGS		= @LDFLAGS@

PROGRAMS	= mmafm
MY_OBJS		= vectori.o hashmapi.o main.o
OBJS		= ../edlib/permstr.o ../edlib/landmark.o ../edlib/slurper.o \
	../edlib/error.o ../edlib/filename.o ../metricslib/encoding.o \
	../metricslib/pairop.o ../metricslib/metrics.o ../metricslib/afm.o \
	../metricslib/afmw.o ../metricslib/amfm.o ../metricslib/findmet.o \
	../metricslib/afmparse.o ../edlib/clp.o ../t1lib/t1cs.o \
	../t1lib/t1interp.o ../t1lib/t1mm.o $(MY_OBJS)

all: $(PROGRAMS)

mmafm: $(OBJS)
	$(CXXLINKER) $(CFLAGS) -o mmafm $(OBJS) $(LDFLAGS)

main.o: main.cc
	$(CXX) -DVERSION=\"$(VERSION)\" $(CPPFLAGS) $(CXXFLAGS) -c main.cc

install: install-prog install-man
install-prog: mmafm
	$(INSTALL_PROGRAM) mmafm $(bindir)/mmafm
install-man:
	$(INSTALL_DATA) mmafm.man $(mandir)/mmafm.$(manext)

#####
# Cleaning and distribution

clean:
	rm -f $(PROGRAMS) $(MY_OBJS) core *.core
mostlyclean: clean
distclean: mostlyclean
	rm -f Makefile
realclean: distclean

dist:
	mkdir -m 0777 ../$(PACKAGE)-$(VERSION)/mmafm
	cp Makefile.in hashmapi.cc vectori.cc main.cc mmafm.man \
	../$(PACKAGE)-$(VERSION)/mmafm

.PHONY: all install install-prog install-man clean mostlyclean distclean \
	realclean dist
